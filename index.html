<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>SteemBotCompare</title>
  <meta name="generator" content="Google Web Designer 2.0.4.0112">
  <style type="text/css" id="gwd-text-style">
    p {
      margin: 0px;
    }
    h1 {
      margin: 0px;
    }
    h2 {
      margin: 0px;
    }
    h3 {
      margin: 0px;
    }
  </style>
  <style type="text/css">
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
    }
    body {
      background-color: transparent;
      transform: perspective(1400px) matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      transform-style: preserve-3d;
    }
    .gwd-p-xkdc {
      position: absolute;
      width: 384px;
      height: 46px;
      left: 375px;
      top: 12px;
      font-family: "Times New Roman";
      text-align: center;
      color: rgb(29, 35, 232);
    }
    .gwd-div-1fei {
      position: absolute;
      height: 34px;
      width: 200px;
      left: 103px;
      top: 1px;
    }
    .gwd-p-1agk {
      position: absolute;
      width: 100px;
      height: 33px;
      left: 0px;
      top: 100px;
      text-align: right;
    }
    .gwd-div-y1zm {
      position: absolute;
      width: 379px;
      height: 633px;
      left: 986px;
      top: 12px;
    }
    .gwd-div-hyfy {
      position: absolute;
      width: 115px;
      height: 26px;
      left: 807px;
      top: 9px;
    }
    .gwd-div-1426 {
      position: absolute;
      width: 84px;
      height: 23px;
      left: 265px;
      top: 134px;
      border-style: solid;
      border-width: 1px;
    }
    .gwd-div-mtwt {
      left: 263px;
    }
    .gwd-div-1uz0 {
      left: 375px;
    }
    .gwd-div-1bzv {
      left: 483px;
    }
    .gwd-div-tqvd {
      left: 591px;
    }
    .gwd-div-bw9a {
      left: 696px;
    }
    .gwd-div-1r63 {
      left: 802px;
    }
    .gwd-div-ph36 {
      width: 120px;
      left: 905px;
    }
    .gwd-p-1qgy {
      position: absolute;
      width: 146px;
      height: 26px;
      left: 1041px;
      top: 134px;
      text-align: center;
    }
    .gwd-p-y899 {
      top: 88px;
    }
    .gwd-div-1dz9 {
      position: absolute;
      width: 100px;
      height: 20.7317px;
      left: -881px;
      top: 76px;
    }
    .gwd-div-1dcx {
      position: absolute;
      overflow: auto;
      background-image: none;
      background-color: rgb(206, 216, 201);
      left: 45px;
      top: 203px;
      height: 460px;
      width: 1260px;
    }
    .gwd-div-1ssr {
      position: absolute;
      width: 134.802px;
      text-overflow: clip;
      border-style: solid;
      border-width: 0px;
      white-space: nowrap;
      top: 16px;
      height: 440px;
      left: 13px;
    }
    .gwd-div-m3fm {
      position: absolute;
      border-style: solid;
      border-width: 0px;
      text-overflow: clip;
      white-space: nowrap;
      top: 16px;
      left: 156px;
      height: 440px;
      width: 600px;
    }
    .gwd-div-824v {
      position: absolute;
      height: 449.966px;
      border-style: solid;
      border-width: 1px;
      top: -2px;
      width: 300px;
      left: 619px;
    }
    .gwd-div-1k5r {
      border-width: 0px;
      width: 150px;
      top: 16px;
      height: 440px;
      left: 940px;
    }
    .gwd-sub-5dj0 {
      position: absolute;
      width: 134.802px;
      height: 28.398px;
      font-size: 16px;
      top: 177px;
      text-align: left;
      left: 60px;
    }
    .gwd-sub-mpbj {
      position: absolute;
      height: 28px;
      font-size: 16px;
      left: 206px;
      top: 178px;
      text-align: left;
      width: 600px;
    }
    .gwd-p-9kqp {
      position: absolute;
      height: 28px;
      width: 150px;
      text-align: left;
      top: 178px;
      left: 820px;
    }
    .gwd-p-exob {
      position: absolute;
      height: 28px;
      width: 150px;
      text-align: left;
      left: 885px;
      top: 178px;
    }
    .gwd-input-ib25 {
      border-radius: 10px;
      transform-style: preserve-3d;
      left: 0px;
      top: 0px;
      width: 150px;
      font-size: 20px;
      text-align: center;
      height: 30px;
      transform: translate3d(802px, 55px, 0px);
    }
    .gwd-div-1jgx {
      left: 263px;
      top: 133px;
    }
    .gwd-input-1404 {
      transform: translate3d(255px, 113px, 0px);
    }
    .gwd-input-1vhw {
      transform: translate3d(255px, 113px, 0px);
    }
    .gwd-p-rek4 {
      top: 68px;
    }
    .gwd-div-w9oo {
      border-width: 0px;
      width: 150px;
      top: 16px;
      height: 440px;
      left: 774px;
    }
    .gwd-span-o0yi {
      position: absolute;
      text-align: center;
      height: 23px;
      left: 219px;
      top: -92px;
      width: 85px;
      transform-origin: 55.7473px 36.2265px 0px;
    }
    .gwd-span-jbfh {
      position: absolute;
      width: 85.5054px;
      height: 22.4474px;
      left: 263px;
      top: 111px;
      text-align: center;
      font-size: 12px;
    }
    .gwd-p-7g3y {
      left: 374px;
      top: 103px;
    }
    .gwd-p-r1du {
      left: 482px;
      top: 103px;
    }
    .gwd-p-1anj {
      left: 591px;
      top: 110px;
    }
    .gwd-p-dm4s {
      left: 695px;
      top: 111px;
    }
    .gwd-p-1ywn {
      left: 802px;
      top: 110px;
    }
    .gwd-p-1oup {
      width: 120px;
      left: 906px;
      top: 103px;
    }
    .gwd-div-1e1t {
      left: 100px;
      top: 67px;
    }
    .gwd-p-lo1t {
      top: 103px;
    }
    .gwd-p-11uv {
      top: 103px;
    }
    .gwd-p-zhuc {
      top: 103px;
    }
    .gwd-p-1ub8 {
      top: 103px;
    }
    .gwd-div-2238 {
      position: absolute;
      height: 440px;
      top: 16px;
      width: 150px;
      left: 1100px;
    }
    .gwd-p-jxzy {
      top: 178px;
      left: 1150px;
    }
    .gwd-input-rq4f {
      left: 150px;
      width: 75px;
      font-size: 12px;
      transform: translate3d(1044px, 128px, 0px);
      visibility: visible;
    }
    .gwd-p-azgy {
      position: absolute;
      width: 342.913px;
      text-align: left;
      left: 1026px;
      top: 1px;
      background-image: none;
      background-color: rgb(218, 206, 74);
      height: 70px;
      font-size: 14px;
    }
    .gwd-p-woyy {
      left: 985px;
    }
    .loadingGif {
      transform: translate3d(960px, 28px, 0px);
      display: none;
    }
  </style>

  <script src="https://cdn.steemjs.com/lib/latest/steem.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/bluebird/3.5.0/bluebird.min.js"></script>

  <script language="javascript">
    // TODO: This should be in a different file (same with the css), served by a simple http server (ie. Node's http-server)
    
    // Accounts holds all of the retrieves accounts. ie:
    // username: {
    //   votes: [votedata...]
    // }
    var accounts = {};

    var voter_valid = false;

    steem.api.setOptions({
      url: 'https://api.steemit.com'
    });

    function showfield(name) {
      if (name == 'other') {
        document.getElementById('Bot_Name_Input').innerHTML = '<input type="text" id="bot_def" autofocus="autofocus" size="10" name="other" />';
        document.getElementById('bot_def').addEventListener("focusout", focusout_func);
      } else {
        document.getElementById('Bot_Name_Input').innerHTML = name;
      }
    }

    function focusout_func() {
      document.getElementById('Bot_Name_Input').innerHTML = document.getElementById('bot_def').value
    }

    var clearSearchFields = function() {
      $('#upvote_date, #post_from, #post_content, #post_date, #Qty_Vote_1, #Qty_Vote_2, #Qty_Vote_3, #Qty_Vote_4, #Qty_Vote_5, #Qty_Vote_6, #Qty_Vote_7, #diff').html('');
    }

    var checkVoterName = function() {
      var voter = $('#Bot_Name_Input').html();
      if (!voter) {
        window.alert("Please enter a bot name   " + voter);
        return false;        
      } else {
        return true;
      }
    }

    var buildPostTable = function() {
      var accountVotes = _.flatten(_.map(accounts, function(account) {
        return account.votes;
      }));

      // Build our strings first, do not redraw iterating. Kills performance.
      var upvoteDateStr = "";
      var postFrom = "";
      var postContent = "";
      var postDate = "";

      accountVotes.forEach(function(accountVote) {
        upvoteDateStr += accountVote.time + "<br />";
        postFrom += accountVote.accountName + "<br />";

        var ref_text = "href='https://steemit.com/@" + accountVote.accountName + "/" + accountVote.perm
        var link_ref = "<a " + "href='https://steemit.com/@" + accountVote.accountName + "/" + accountVote.perm + "'>link</a>";

        postContent += link_ref + "--------" + accountVote.perm + "<br />";
        postDate += accountVote.postDate + "<br />";
      });

      document.getElementById("upvote_date").style.fontSize = "small";
      document.getElementById('upvote_date').innerHTML = upvoteDateStr;

      document.getElementById("post_from").style.fontSize = "small";
      document.getElementById('post_from').innerHTML = postFrom;

      document.getElementById("post_content").style.fontSize = "small";
      document.getElementById('post_content').innerHTML = postContent;

      document.getElementById("post_date").style.fontSize = "small";
      document.getElementById('post_date').innerHTML = postDate;
    }

    function search() {
      clearSearchFields();

      if (checkVoterName()) {

        // Disable while we search, to prevent double clicking
        // Show a spinner
        $('#analyse_but').attr('disabled', true);
        $('.loadingGif').show();

        voter = document.getElementById('Bot_Name_Input').innerHTML;
        bot = voter; // Why twice?

        var selectedDate = document.getElementById('Sday').value;
        var selectedDateUnix = moment(selectedDate, "YYYY-MM-DD").valueOf();
        var nextDateUnix = moment(selectedDateUnix).add(1, 'days').valueOf();

        steem.api.getAccountVotes(bot, function(err, result) {
          var accountVotes = result;

          // Filter and return all of the account votes between the selected date and the next
          var accountVotesFilteredForSelectedDate = _.filter(accountVotes, function(accountVote) {
            var accountVoteDateUnix = moment(accountVote.time).valueOf();
            return (accountVoteDateUnix >= selectedDateUnix && accountVoteDateUnix <= nextDateUnix);
          });

          // Here we will wait for all promises to resolve before building our table and calculating
          Promise.map(accountVotesFilteredForSelectedDate, function(filteredVote) {
            var dfd = jQuery.Deferred();
            var authorPerm = filteredVote.authorperm.split("/");

            steem.api.getContent(authorPerm[0], authorPerm[1], function(err, result) {
              if (err) {
                dfd.reject(error);
              } else {

                filteredVote.accountName = authorPerm[0];
                filteredVote.perm = authorPerm[1];
                filteredVote.postDate = result.created;
                filteredVote.content = result; // Keep track of the whole object, in case we need it later

                // keep track of all votes in a single object per user
                if (!accounts[authorPerm[0]]) {
                  accounts[authorPerm[0]] = {
                    votes: [filteredVote]
                  }                  
                } else {
                  accounts[authorPerm[0]].votes.push(filteredVote);
                }

                dfd.resolve(result);
              }
            });

            return dfd.promise();            
          }).then(function(allPromisesDone) {
            //Reenable and hide spinner
            $('#analyse_but').attr('disabled', false);
            $('.loadingGif').hide();

            buildPostTable(); // Build table
            calculate(); // Parse values
          });

        });
      }
    }

    // TODO: This could be reworked with MomentJS
    function calculate() {
      var d1 = 0;
      var d2 = 0;
      var d3 = 0;
      var d4 = 0;
      var d5 = 0;
      var d6 = 0;
      var d7 = 0;
      upvote_tot = document.getElementById('upvote_date').innerHTML;
      upvote_arr = upvote_tot.split("<br>");
      cr_tot = document.getElementById('post_date').innerHTML;
      cr_arr = cr_tot.split("<br>");

      for (x = 0; x < upvote_arr.length; x++) {
        update = new Date(upvote_arr[x]);
        pdate = new Date(cr_arr[x]);
        umsec = update.getTime();
        pmsec = pdate.getTime();

        diff = ((umsec - pmsec) / 86400000);
        document.getElementById("diff").style.fontSize = "small";
        document.getElementById('diff').innerHTML = document.getElementById('diff').innerHTML + diff.toFixed(2) + "<br />";
        if (diff >= 0 && diff < 1) {
          d1++;
        }

        if (diff >= 1 && diff < 2) {
          d2++;
        }
        if (diff >= 2 && diff < 3) {
          d3++;
        }
        if (diff >= 3 && diff < 4) {
          d4++;
        }
        if (diff >= 4 && diff < 5) {
          d5++;
        }
        if (diff >= 5 && diff < 6) {
          d6++;
        }
        if (diff >= 6) {
          d7++;
        }
      }

      document.getElementById('Qty_Vote_1').innerHTML = d1;
      document.getElementById('Qty_Vote_2').innerHTML = d2;
      document.getElementById('Qty_Vote_3').innerHTML = d3;
      document.getElementById('Qty_Vote_4').innerHTML = d4;
      document.getElementById('Qty_Vote_5').innerHTML = d5;
      document.getElementById('Qty_Vote_6').innerHTML = d6;
      document.getElementById('Qty_Vote_7').innerHTML = d7;


    }
  </script>
</head>

<body class="htmlNoPages">
  <h1 class="gwd-p-xkdc" id="Header">STEEM BOT ANALYSIS</h1>
  <div class="gwd-div-1fei gwd-div-1e1t" id="Bot_Name">
    <select onchange="showfield(this.options[this.selectedIndex].value)">
      <option value="upme">upme</option>
      <option value="appreciator">appreciator</option>
      <option value="buildawhale">buildawhale</option>
      <option value="booster">booster</option>
      <option value="sneaky-ninja">sneaky-ninja</option>
      <option value="boomerang">boomerang</option>
      <option value="pushup">pushup</option>
      <option value="upmyvote">upmyvote</option>
      <option value="other">other</option>
    </select>
  </div>
  <p class="gwd-p-1agk gwd-p-rek4" id="Bot_Tag">Bot Name @</p>
  <p class="gwd-p-1agk gwd-p-y899" id="Bot_Tag_1">@</p>
  <div class="gwd-div-y1zm" id="side">
    <div class="gwd-div-1dz9" id="Bot_Name_Input">upme</div>
  </div>
  <div class="gwd-div-hyfy" id="SDate">
    <form action="/action_page.php">
      Analysis Date:
      <input type="date" id="Sday" name="Sday" value="2018-01-01">
    </form>
  </div>
  <div class="gwd-div-1426 gwd-div-mtwt gwd-div-1jgx" id="Qty_Vote_1"></div>
  <div class="gwd-div-1426 gwd-div-1uz0" id="Qty_Vote_2"></div>
  <div class="gwd-div-1426 gwd-div-1uz0 gwd-div-1bzv" id="Qty_Vote_3"></div>
  <div class="gwd-div-1426 gwd-div-1uz0 gwd-div-1bzv gwd-div-tqvd" id="Qty_Vote_4"></div>
  <div class="gwd-div-1426 gwd-div-1uz0 gwd-div-1bzv gwd-div-tqvd gwd-div-bw9a" id="Qty_Vote_5"></div>
  <div class="gwd-div-1426 gwd-div-1uz0 gwd-div-1bzv gwd-div-tqvd gwd-div-bw9a gwd-div-1r63" id="Qty_Vote_6"></div>
  <div class="gwd-div-1426 gwd-div-1uz0 gwd-div-1bzv gwd-div-tqvd gwd-div-bw9a gwd-div-1r63 gwd-div-ph36" id="Qty_Vote_7"></div>
  <p class="gwd-p-1qgy" id="Tot_upvote_label">quantity of upvotes</p>
  <div class="gwd-div-1dcx" id="Posts">
    <div class="gwd-div-1ssr" id="post_from"></div>
    <div class="gwd-div-m3fm" id="post_content"></div>
    <div class="gwd-div-824v gwd-div-w9oo" id="post_date"></div>
    <div class="gwd-div-824v gwd-div-1k5r" id="upvote_date"></div>
    <span class="gwd-span-o0yi"><br class=""></span>
    <div class="gwd-div-2238" id="diff"></div>
  </div>
  <p class="gwd-sub-5dj0" id="from_label">From</p>
  <p class="gwd-sub-mpbj" id="post_label">Posts<br>
    
  </p>
  <p class="gwd-p-9kqp" id="p_date_label">Post Date</p>
  <p class="gwd-p-exob gwd-p-jxzy" id="diff_label">Upvoted after (days)</p>
  <p class="gwd-p-exob gwd-p-woyy" id="u_date_label">Upvote Date</p>
  <input id="analyse_but" type="button" value=" Start Analysis " class="gwd-input-ib25" onclick="search()">
  <div class="loadingGif"><img src="https://cdnjs.cloudflare.com/ajax/libs/timelinejs/2.25/css/loading.gif" alt="Loading" width="25"></div>
  <p class="gwd-span-jbfh gwd-p-r1du" id="l3_day">2 to 3 days upvotes</p>
  <p class="gwd-span-jbfh gwd-p-lo1t" id="l1_day">0 to 1 day upvotes</p>
  <p class="gwd-span-jbfh gwd-p-1anj gwd-p-dm4s gwd-p-zhuc" id="l5_day">4 to 5 days upvotes</p>
  <p class="gwd-span-jbfh gwd-p-1anj gwd-p-dm4s gwd-p-1ywn gwd-p-1ub8" id="l6_day">5 to 6 days upvotes</p>
  <p class="gwd-span-jbfh gwd-p-1anj gwd-p-dm4s gwd-p-1ywn gwd-p-1oup" id="l7_day">more than 6 days upvotes</p>
  <p class="gwd-span-jbfh gwd-p-1anj gwd-p-11uv" id="l4_day">3 to 4 days upvotes</p>
  <p class="gwd-span-jbfh gwd-p-7g3y" id="l2_day">1 to 2 days upvotes</p>
  <p class="gwd-p-azgy">&nbsp; &nbsp;How to Use :<br>
    &nbsp; &nbsp;1- Select bot or select "OTHER" to enter a bot name<br>
    &nbsp; &nbsp;2- Select analysis date<br>
    &nbsp; &nbsp;3- Press "START ANALYSIS" to get results<br>
  <br>
  </p>
</body>

</html>